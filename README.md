# üìß RageMail Bot - –ê–Ω–æ–Ω–∏–º–Ω—ã–π Telegram-–±–æ—Ç

> –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π Telegram-–±–æ—Ç –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω–æ–π –ø–µ—Ä–µ–ø–∏—Å–∫–∏ —Å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π

> ‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ –±–µ—Ç–∞-–≤–µ—Ä—Å–∏—è (v0.1.1b). –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–π.**

> üö® **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –≠—Ç–æ—Ç –±–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞–ø–∏—Å–∞–Ω –≤–∞–π–±-–∫–æ–¥–æ–º!** 
> 
> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞ —Å–≤–æ–π —Å—Ç—Ä–∞—Ö –∏ —Ä–∏—Å–∫. –¢—Ä—É-–ø–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ª–µ–∑—Ç—å –≤ –∫–æ–¥ —Ç–æ–ª—å–∫–æ –≤ —Å—Ä–µ–¥—Å—Ç–≤–∞—Ö –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã. 
> –ë–æ—Ç –≤—Å—ë –µ—â—ë –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è.

[![Python](https://img.shields.io/badge/Python-3.13+-blue.svg)](https://python.org)
[![aiogram](https://img.shields.io/badge/aiogram-3.x-green.svg)](https://docs.aiogram.dev)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![Version](https://img.shields.io/badge/Version-0.1.1b-orange.svg)](CHANGELOG.md)
[![Beta](https://img.shields.io/badge/Status-Beta-red.svg)](CHANGELOG.md)
[![GitHub release](https://img.shields.io/github/release/a-quilam/ragemail_bot.svg)](https://github.com/a-quilam/ragemail_bot/releases)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª:**
   ```bash
   cp bot/.env.example bot/.env
   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ bot/.env –∏ –¥–æ–±–∞–≤—å—Ç–µ BOT_TOKEN
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   ```bash
   pip install -r bot/requirements.txt
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:**
   ```bash
   cd bot && python -m app.main
   ```

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üîí **–ê–Ω–æ–Ω–∏–º–Ω–∞—è –ø–µ—Ä–µ–ø–∏—Å–∫–∞** —á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª—ã
- üõ°Ô∏è **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- ‚ö° **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
- üîÑ **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** —Å circuit breakers –∏ rollback —Å–∏—Å—Ç–µ–º–æ–π
- üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- üéØ **–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

> üíÄ **–í–ê–ô–ë-–ö–û–î –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï:** –í–æ—Ç —ç—Ç–æ —è –Ω–∞–≤–∞–ª–∏–ª –≤–∞–π–±-–∫–æ–¥–∞! 
> 
> –ö–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Ç–≤–æ—Ä—á–µ—Å–∫–æ–≥–æ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è –∏ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è. 
> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é –∏ –Ω–µ —É–¥–∏–≤–ª—è–π—Ç–µ—Å—å —Å—Ç—Ä–∞–Ω–Ω—ã–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º –≤ –∫–æ–¥–µ.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
bot/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ core/           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ features/       # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ infra/          # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ API
‚îÇ   ‚îú‚îÄ‚îÄ services/       # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ utils/          # –£—Ç–∏–ª–∏—Ç—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ validators/     # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ tests/              # –¢–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ docs/               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### üîß –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **Circuit Breaker** - –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–±–æ–µ–≤
- **Concurrency Manager** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å—é
- **Performance Logger** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **Rollback Manager** - –æ—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- **Resource Manager** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏

### –ü–æ—Ä—è–¥–æ–∫ —Ä–æ—É—Ç–µ—Ä–æ–≤ (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!)
–ü–æ—Ä—è–¥–æ–∫ –≤–∫–ª—é—á–µ–Ω–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤ –≤ `main.py` –∏–º–µ–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:

```python
dp.include_router(admin_router)      # 1. –ê–¥–º–∏–Ω—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ - –ü–ï–†–í–´–ô!
dp.include_router(start_router)      # 2. –ö–æ–º–∞–Ω–¥—ã /start, /help, /cancel
dp.include_router(bind_router)       # 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ start payload
dp.include_router(write_router)      # 4. –ù–∞–ø–∏—Å–∞–Ω–∏–µ –ø–∏—Å–µ–º - –î–û–õ–ñ–ï–ù –ë–´–¢–¨ –ü–ï–†–ï–î relay_router!
dp.include_router(relay_router)      # 5. /end –∫–æ–º–∞–Ω–¥–∞ –∏ —Ä–µ–ª–µ–∏
dp.include_router(channel_router)    # 6. Callback –∫–Ω–æ–ø–∫–∏ –∫–∞–Ω–∞–ª–æ–≤
dp.include_router(auto_detect_router) # 7. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤
dp.include_router(debug_router)      # 8. –û—Ç–ª–∞–¥–æ—á–Ω—ã–π —Ä–æ—É—Ç–µ—Ä - –ø–æ—Å–ª–µ–¥–Ω–∏–π
dp.include_router(direct_write_router) # 9. –ü—Ä—è–º–æ–µ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

**–í–ê–ñ–ù–û:** `write_router` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ü–ï–†–ï–î `relay_router`, –∏–Ω–∞—á–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `pipe` –≤ `relay_router` –±—É–¥–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–∏—Å–µ–º

#### 1. Write Router (`app/features/write/router.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—Å–Ω–æ–≤–Ω–æ–π —Ä–æ—É—Ç–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–∏—Å–µ–º

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:**
- `on_write_button` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –ø–∏—Å—å–º–æ"
- `on_text_input` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `INPUT_TEXT`
- `on_auto_text_input` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- TTL –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ - –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ –ø–æ—Å—Ç–∞
- Callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ - –æ—Ç–ø—Ä–∞–≤–∫–∞, –æ—Ç–º–µ–Ω–∞, —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤

**–§–∏–ª—å—Ç—Ä—ã:**
```python
# –ö–Ω–æ–ø–∫–∞ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–∏—Å—å–º–∞
router.message.register(on_write_button, F.text == "‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –ø–∏—Å—å–º–æ")

# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ INPUT_TEXT
router.message.register(on_text_input, StateFilter(WriteStates.INPUT_TEXT))

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ (—Å –∫–∞—Å—Ç–æ–º–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–æ–º)
router.message.register(on_auto_text_input, auto_text_filter)
```

**–ö–∞—Å—Ç–æ–º–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä `auto_text_filter`:**
```python
async def auto_text_filter(message, state: FSMContext):
    # –ò—Å–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏
    if message.text and any(message.text.startswith(prefix) for prefix in ["‚úçÔ∏è", "‚öôÔ∏è", "üìä", "üìå", "üîÑ", "üõ°Ô∏è"]):
        return False
    
    # –ò—Å–∫–ª—é—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ INPUT_TEXT (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è on_text_input)
    current_state = await state.get_state()
    if current_state == WriteStates.INPUT_TEXT:
        return False
    
    return True
```

#### 2. Write Button Handler (`app/features/write/action_write_button.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ "‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –ø–∏—Å—å–º–æ"

**–§—É–Ω–∫—Ü–∏—è:** `on_write_button(m, state, active_mailbox_id, **kwargs)`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –û—á–∏—â–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å—Ç–ø–∏–Ω–∞ (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –Ω–µ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è)
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç FSM —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ `WriteStates.INPUT_TEXT`
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥–ª—è –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏

#### 3. Text Input Handler (`app/features/write/state_input_text.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞, –≤–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `INPUT_TEXT`

**–§—É–Ω–∫—Ü–∏—è:** `on_text_input(m, state, db, tz, active_mailbox_id)`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç (–¥–ª–∏–Ω–∞, –ø—É—Å—Ç–æ—Ç–∞)
2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Å–µ–≤–¥–æ–Ω–∏–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç –≤ FSM –¥–∞–Ω–Ω—ã–µ
4. –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `WriteStates.CHOOSE_TTL`
5. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ –ø–æ—Å—Ç–∞

#### 4. Auto Text Handler (`app/features/write/auto_text_handler.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω–µ –∞–¥–º–∏–Ω–æ–≤)

**–§—É–Ω–∫—Ü–∏—è:** `on_auto_text_input(m, state, db, active_mailbox_id, tz)`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–¥–º–∏–Ω
2. –ï—Å–ª–∏ –∞–¥–º–∏–Ω –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `INPUT_TEXT` - –ù–ï –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
3. –î–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–∏—Å—å–º–∞

#### 5. Relay Router (`app/features/relay/router.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ —Ä–µ–ª–µ—è –∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Ä–µ–ª–µ—è

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:**
- `cmd_end` - –∫–æ–º–∞–Ω–¥–∞ `/end`
- `pipe` - –ø–µ—Ä–µ—Ö–≤–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Ä–µ–ª–µ—è

**–í–ê–ñ–ù–û:** `pipe` –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–º–µ–µ—Ç —Ñ–∏–ª—å—Ç—Ä, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–∫–ª—é—á–∞–µ—Ç –∫–Ω–æ–ø–∫–∏:
```python
router.message.register(pipe, ~F.text.startswith("‚úçÔ∏è") & ~F.text.startswith("‚öôÔ∏è") & ...)
```

#### 6. Direct Write Router (`app/main.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä—è–º–æ–µ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ –ø–∏—Å–µ–º –æ–±—ã—á–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –±–µ–∑ –∫–Ω–æ–ø–æ–∫

**–§–∏–ª—å—Ç—Ä:** `not_in_fsm_filter` - –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ù–ï –≤ FSM —Å–æ—Å—Ç–æ—è–Ω–∏–∏

### FSM –°–æ—Å—Ç–æ—è–Ω–∏—è (`app/fsm/write_states.py`)

```python
class WriteStates(StatesGroup):
    INPUT_TEXT = State()      # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç –ø–∏—Å—å–º–∞
    CHOOSE_TTL = State()      # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –ø–æ—Å—Ç–∞
    PREVIEW = State()         # –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–∏—Å—å–º–∞
```

### –ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

#### –î–ª—è –∞–¥–º–∏–Ω–æ–≤ (—Å –∫–Ω–æ–ø–∫–æ–π):
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –ø–∏—Å—å–º–æ"
2. `on_write_button` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ `INPUT_TEXT`
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç
4. `on_text_input` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç, –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ `CHOOSE_TTL`
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏
6. –ü–∏—Å—å–º–æ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è

#### –î–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–±–µ–∑ –∫–Ω–æ–ø–∫–∏):
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å—Ç–æ –ø–∏—à–µ—Ç —Ç–µ–∫—Å—Ç
2. `on_auto_text_input` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å
3. –î–∞–ª–µ–µ –∫–∞–∫ —É –∞–¥–º–∏–Ω–æ–≤

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã

#### 1. –ü–æ—Ä—è–¥–æ–∫ —Ä–æ—É—Ç–µ—Ä–æ–≤
- `write_router` –î–û–õ–ñ–ï–ù –±—ã—Ç—å –ü–ï–†–ï–î `relay_router`
- –ò–Ω–∞—á–µ `pipe` –≤ `relay_router` –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è

#### 2. –§–∏–ª—å—Ç—Ä—ã
- `auto_text_filter` –∏—Å–∫–ª—é—á–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ `INPUT_TEXT`
- `pipe` –∏—Å–∫–ª—é—á–∞–µ—Ç –∫–Ω–æ–ø–∫–∏
- `not_in_fsm_filter` –∏—Å–∫–ª—é—á–∞–µ—Ç FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è

#### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–¥–º–∏–Ω–æ–≤
- –ê–¥–º–∏–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–Ω–æ–ø–∫–∏
- `on_auto_text_input` –ù–ï –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∞–¥–º–∏–Ω–æ–≤ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `INPUT_TEXT`

### –û—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ "‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –ø–∏—Å—å–º–æ" –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Ä–æ—É—Ç–µ—Ä–æ–≤** - `write_router` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ü–ï–†–ï–î `relay_router`
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** - –∏—â–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –§–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã

```
app/features/write/
‚îú‚îÄ‚îÄ router.py              # –û—Å–Ω–æ–≤–Ω–æ–π —Ä–æ—É—Ç–µ—Ä
‚îú‚îÄ‚îÄ action_write_button.py # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏
‚îú‚îÄ‚îÄ state_input_text.py    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞
‚îú‚îÄ‚îÄ auto_text_handler.py   # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚îú‚îÄ‚îÄ ttl_handlers.py        # –û–±—Ä–∞–±–æ—Ç–∫–∞ TTL
‚îî‚îÄ‚îÄ action_*.py           # –î—Ä—É–≥–∏–µ –¥–µ–π—Å—Ç–≤–∏—è

app/fsm/
‚îî‚îÄ‚îÄ write_states.py        # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è

app/main.py                # –ü–æ—Ä—è–¥–æ–∫ —Ä–æ—É—Ç–µ—Ä–æ–≤
```

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Python 3.13+** - –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫
- **aiogram 3.x** - Telegram Bot API
- **aiosqlite** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **asyncio** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Pydantic** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

- **138 Python —Ñ–∞–π–ª–æ–≤**
- **~16,400 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞**
- **9 –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π**
- **–ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏**

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/a-quilam/ragemail_bot.git
cd ragemail_bot

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r bot/requirements.txt

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env —Ñ–∞–π–ª
cp bot/.env.example bot/.env
# –î–æ–±–∞–≤—å—Ç–µ BOT_TOKEN –≤ bot/.env

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
cd bot && python -m app.main
```

### Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```bash
# –°–æ–∑–¥–∞–π—Ç–µ Dockerfile –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ Docker
docker build -t ragemail-bot .
docker run -d ragemail-bot
```

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. **Fork** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. **–°–æ–∑–¥–∞–π—Ç–µ** feature branch (`git checkout -b feature/amazing-feature`)
3. **–°–¥–µ–ª–∞–π—Ç–µ** –∫–æ–º–º–∏—Ç (`git commit -m 'Add amazing feature'`)
4. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ** –≤ branch (`git push origin feature/amazing-feature`)
5. **–û—Ç–∫—Ä–æ–π—Ç–µ** Pull Request

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ MIT License - —Å–º. —Ñ–∞–π–ª [LICENSE](LICENSE) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

**a-quilam** - [GitHub](https://github.com/a-quilam)

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- –ö–æ–º–∞–Ω–¥–µ aiogram –∑–∞ –æ—Ç–ª–∏—á–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É
- –°–æ–æ–±—â–µ—Å—Ç–≤—É Python –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É
- –í—Å–µ–º –∫–æ–Ω—Ç—Ä–∏–±—å—é—Ç–æ—Ä–∞–º –ø—Ä–æ–µ–∫—Ç–∞

---

‚≠ê **–ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è, –ø–æ—Å—Ç–∞–≤—å—Ç–µ –∑–≤–µ–∑–¥—É!**
## Git Setup Complete! üéâ
