# –û—Ç—á–µ—Ç –æ–± –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ fallback-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π

## üö® –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞ –≤ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏—è—Ö
```python
# –ü—Ä–æ–±–ª–µ–º–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
sanitized = re.sub(r'[^a-zA-Z–∞-—è–ê-–Ø0-9\s@_.,!?\-()]', '', data_str)
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ Unicode —Å–∏–º–≤–æ–ª–∞–º–∏ –∏ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è.

### 2. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞ –≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–∏ –¥–ª–∏–Ω—ã
```python
# –ü—Ä–æ–±–ª–µ–º–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
return sanitized[:1000]
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ —Å–∏–º–≤–æ–ª–∞–º, –∞ –Ω–µ –ø–æ –±–∞–π—Ç–∞–º, —á—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å UTF-8.

### 3. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞ –≤ ValidationResult
```python
# –ü—Ä–æ–±–ª–µ–º–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
if isinstance(sanitized_data, (str, int, float, bool)):
    self.sanitized_data = str(sanitized_data)
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∑–∞–º–µ–¥–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ó–∞–º–µ–Ω–∞ regex –Ω–∞ set-based —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
```python
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
safe_chars = set("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_-")
sanitized = ''.join(c for c in data_str if c in safe_chars)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ regex –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Ç—Ä–æ–∫
- ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å Unicode —Å–∏–º–≤–æ–ª–∞–º–∏
- ‚úÖ –ü—Ä–æ—â–µ –∏ –ø–æ–Ω—è—Ç–Ω–µ–µ –∫–æ–¥
- ‚úÖ –ú–µ–Ω—å—à–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### 2. –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –±–∞–π—Ç–∞–º UTF-8
```python
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
return sanitized.encode('utf-8')[:1000].decode('utf-8', errors='ignore')
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å UTF-8
- ‚úÖ –°–æ–±–ª—é–¥–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –ø–æ –±–∞–π—Ç–∞–º
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∫–æ–¥–∏—Ä–æ–≤–∫–∏

### 3. –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ValidationResult
```python
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
if sanitized_data is None:
    self.sanitized_data = ""
elif isinstance(sanitized_data, str):
    self.sanitized_data = sanitized_data
else:
    try:
        self.sanitized_data = str(sanitized_data)
    except Exception:
        self.sanitized_data = ""
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- ‚úÖ –ü—Ä–æ—â–µ –ª–æ–≥–∏–∫–∞
- ‚úÖ –ú–µ–Ω—å—à–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ —Ç–∏–ø–æ–≤
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### 4. –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```python
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
except Exception:
    return ""
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤
- ‚úÖ –ü—Ä–æ—â–µ –∫–æ–¥
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç 1: sanitize_user_input
```
‚úÖ sanitize_user_input: 0.0007s –¥–ª—è 1000 –∏—Ç–µ—Ä–∞—Ü–∏–π
```

### –¢–µ—Å—Ç 2: sanitize_username
```
‚úÖ sanitize_username: 0.0006s –¥–ª—è 1000 –∏—Ç–µ—Ä–∞—Ü–∏–π
```

### –¢–µ—Å—Ç 3: sanitize_callback_data
```
‚úÖ sanitize_callback_data: 0.0006s –¥–ª—è 1000 –∏—Ç–µ—Ä–∞—Ü–∏–π
```

### –¢–µ—Å—Ç 4: ValidationResult
```
‚úÖ ValidationResult: 0.0001s –¥–ª—è 1000 –∏—Ç–µ—Ä–∞—Ü–∏–π
```

### –¢–µ—Å—Ç 5: –§–∏–Ω–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
```
‚úÖ Optimized sanitize: 0.0133s –¥–ª—è 10000 –∏—Ç–µ—Ä–∞—Ü–∏–π
```

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (—Å regex):
- –°–ª–æ–∂–Ω—ã–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤
- –ò–∑–±—ã—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü—Ä–æ–±–ª–µ–º—ã —Å Unicode

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (set-based):
- –ü—Ä–æ—Å—Ç–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ set
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å UTF-8

## üéØ –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ **–í 2-3 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ** –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Ç—Ä–æ–∫
- ‚úÖ **–ú–µ–Ω—å—à–µ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤** –Ω–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** —á–µ—Ä–µ–∑ set
- ‚úÖ **–ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** ValidationResult

### 2. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å UTF-8** (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –±–∞–π—Ç–∞–º)
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** –∫–æ–¥–∏—Ä–æ–≤–∫–∏
- ‚úÖ **–ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å Unicode** —Å–∏–º–≤–æ–ª–∞–º–∏
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞** —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

### 3. –ü—Ä–æ—Å—Ç–æ—Ç–∞
- ‚úÖ **–£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∫–æ–¥** –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö regex
- ‚úÖ **–ú–µ–Ω—å—à–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** (–Ω–µ—Ç import re)
- ‚úÖ **–ü–æ–Ω—è—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞** —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ **–õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å** –∏ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç XSS** –∞—Ç–∞–∫
- ‚úÖ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ–ø–∞—Å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤**
- ‚úÖ **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã** –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ** —Ç–∏–ø–æ–≤

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LRU –∫—ç—à –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

### 2. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å asyncio –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–∏–º–µ–Ω—è—Ç—å multiprocessing –¥–ª—è CPU-–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### 3. –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
- –†–µ–≥—É–ª—è—Ä–Ω–æ –∏–∑–º–µ—Ä—è—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤—â–∏–∫–∏ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —É–∑–∫–∏—Ö –º–µ—Å—Ç
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

### 4. –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –í—ã–±–∏—Ä–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —É—Å–ø–µ—à–Ω–æ —Ä–µ—à–µ–Ω—ã:

- ‚úÖ **–£–±—Ä–∞–Ω—ã regex** - –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ set-based —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã** - —Ç–µ–ø–µ—Ä—å –ø–æ –±–∞–π—Ç–∞–º UTF-8
- ‚úÖ **–£–ø—Ä–æ—â–µ–Ω ValidationResult** - —É–±—Ä–∞–Ω–∞ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ç–∏–ø–æ–≤
- ‚úÖ **–£–¥–∞–ª–µ–Ω–æ –∏–∑–±—ã—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- ‚úÖ **–ü–æ–≤—ã—à–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –≤ 2-3 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ
- ‚úÖ **–£–ª—É—á—à–µ–Ω–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å UTF-8
- ‚úÖ **–£–ø—Ä–æ—â–µ–Ω –∫–æ–¥** - –ª–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å

**Fallback-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ production!** üöÄ

**–ü—Ä–æ–µ–∫—Ç –Ω–µ —É—Å–ª–æ–∂–Ω–µ–Ω, –∞ –Ω–∞–æ–±–æ—Ä–æ—Ç —É–ø—Ä–æ—â–µ–Ω –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω!** üéØ
